CREATE DATABASE Bai5;
GO

USE Bai5;
GO

CREATE TABLE dbo.GV (
    MAGV nchar(10) PRIMARY KEY,
    TENGV nvarchar(50) NULL,
    MAMH nchar(10) NULL,
    FOREIGN KEY (MAMH) REFERENCES MHOC(MAMH)
);
GO

CREATE TABLE dbo.MHOC (
    MAMH nchar(10) PRIMARY KEY,
    TENMH nvarchar(50),
    SOTIET int
);
GO

CREATE TABLE dbo.BUOITHI (
    HKY int,
    NGAY date,
    GIO nvarchar(10),
    PHG int, 
    MAMH nchar(10),
    TGTHI int,
    PRIMARY KEY(HKY, NGAY, GIO, PHG),
    FOREIGN KEY (MAMH) REFERENCES MHOC(MAMH)
);
GO

CREATE TABLE dbo.PC_COI_THI (
    MAGV nchar(10),
    HKY int,
    NGAY date,
    GIO nvarchar(10),
    PHG int,
    PRIMARY KEY (MAGV, HKY, NGAY, GIO, PHG),
    FOREIGN KEY (MAGV) REFERENCES GV(MAGV),
    FOREIGN KEY (HKY, NGAY,GIO, PHG) REFERENCES BUOITHI(HKY, NGAY, GIO, PHG)
);

INSERT INTO dbo.GV (MAGV, TENGV, MAMH)
VALUES
    ('GV001', N'NGUYỄN HỒNG NHUNG', 'MH01'),
    ('GV002', N'VŨ THÚY NGA', NULL),
    ('GV003', N'TRẦN KIM TRI', 'MH02'),
    ('GV004', N'NGUYỄN THỊ THANH THU', NULL),
    ('GV005', N'TRẦN HOÀI DẠ VŨ', 'MH03'),
    ('GV006', N'TRẦN XUÂN QUỲNH', NULL),
    ('GV007', N'LÊ THU HOÀI', 'MH04'),
    ('GV008', N'NGUYỄN THỊ HỒNG THANH', 'MH08'),
    ('GV009', N'TRẦN THANH TÙNG', 'MH05'),
    ('GV010', N'VŨ KIM HOÀNG', NULL);

INSERT INTO dbo.MHOC (MAMH, TENMH, SOTIET)
VALUES
    ('MH01', N'TOÁN', 45),
    ('MH02', N'VẬT LÝ', 30),
    ('MH03', N'HÓA HỌC', 45),
    ('MH04', N'SINH HỌC', 30),
    ('MH05', N'TIẾNG ANH', 45),
    ('MH06', N'LỊCH SỬ', 30),
    ('MH07', N'ĐỊA LÝ', 45),
    ('MH08', N'VĂN HỌC', 30),
    ('MH09', N'MỸ THUẬT', 45),
    ('MH10', N'ÂM NHẠC', 30),
    ('MH11', N'THỂ DỤC', 45),
    ('MH12', N'TIN HỌC', 30);

INSERT INTO dbo.BUOITHI (HKY, NGAY, GIO, PHG, MAMH, TGTHI)
VALUES
    (1, '2024-03-15', '08:00', 101, 'MH01', 150),
    (1, '2024-03-16', '09:00', 102, 'MH02', 120),
    (1, '2024-03-17', '10:00', 103, 'MH03', 150),
    (1, '2024-03-18', '11:00', 104, 'MH04', 120),
    (1, '2024-03-19', '12:00', 105, 'MH05', 150),
    (2, '2024-03-20', '08:00', 106, 'MH06', 120),
    (2, '2024-03-21', '09:00', 107, 'MH07', 150),
    (2, '2024-03-22', '10:00', 108, 'MH08', 120),
    (2, '2024-03-23', '11:00', 109, 'MH09', 150),
    (2, '2024-03-24', '12:00', 110, 'MH10', 120),
    (3, '2024-03-25', '08:00', 111, 'MH11', 150),
    (3, '2024-03-26', '09:00', 112, 'MH12', 120),
    (3, '2024-03-27', '10:00', 101, 'MH01', 150),
    (3, '2024-03-28', '11:00', 102, 'MH02', 120),
    (3, '2024-03-29', '12:00', 103, 'MH03', 150);

INSERT INTO dbo.PC_COI_THI (MAGV, HKY, NGAY, GIO, PHG)
VALUES
	('GV001',1, '2024-03-15', '08:00', 101),
    ('GV002',1, '2024-03-16', '09:00', 102),
    ('GV003',1, '2024-03-17', '10:00', 103),
    ('GV008',1, '2024-03-18', '11:00', 104),
    ('GV008',1, '2024-03-19', '12:00', 105),
    ('GV008',2, '2024-03-20', '08:00', 106),
    ('GV007',2, '2024-03-21', '09:00', 107),
    ('GV005',2, '2024-03-22', '10:00', 108),
    ('GV009',2, '2024-03-23', '11:00', 109),
    ('GV010',2, '2024-03-24', '12:00', 110),
    ('GV008',3, '2024-03-25', '08:00', 111),
    ('GV008',3, '2024-03-26', '09:00', 112),
    ('GV003',3, '2024-03-27', '10:00', 101),
    ('GV004',3, '2024-03-28', '11:00', 102),
    ('GV005',3, '2024-03-29', '12:00', 103);


SELECT DISTINCT GV.MAGV, GV.TENGV, MHOC.TENMH, MHOC.SOTIET
FROM GV 
INNER JOIN MHOC ON GV.MAMH = MHOC.MAMH
WHERE MHOC.SOTIET >= 45;

SELECT DISTINCT GV.MAGV, GV.TENGV
FROM GV
JOIN PC_COI_THI ON GV.MAGV = PC_COI_THI.MAGV
JOIN BUOITHI ON PC_COI_THI.HKY = BUOITHI.HKY
WHERE BUOITHI.HKY = 1;

SELECT GV.MAGV, GV.TENGV
FROM GV
WHERE GV.MAGV NOT IN (
    SELECT PC_COI_THI.MAGV
    FROM PC_COI_THI
    JOIN BUOITHI ON PC_COI_THI.HKY = BUOITHI.HKY
    WHERE BUOITHI.HKY = 1
);

SELECT BUOITHI.HKY, BUOITHI.NGAY, BUOITHI.GIO, BUOITHI.PHG
FROM BUOITHI
JOIN MHOC ON BUOITHI.MAMH = MHOC.MAMH
WHERE MHOC.TENMH = 'VĂN HỌC';

SELECT NGAY, GIO, PHG
FROM PC_COI_THI INNER JOIN (SELECT TENMH, MAGV FROM MHOC INNER JOIN GV ON MHOC.MAMH=GV.MAMH) as TEMP ON PC_COI_THI.MAGV=TEMP.MAGV
WHERE TEMP.TENMH='VAN HOC'











